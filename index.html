<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Top 200 Drugs Quiz</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    /* CSS VARIABLES */
    :root {
      --bg: #ffffff;
      --text: #222222;
      --card-bg: #ffffff;
      --border-color: #ddd;
      --button-bg: #ffe0f0;
      --button-border: #ff99c9;
      --button-hover: #ffc5e0;
      --button-active-bg: #ff99c9;
      --button-active-text: #222;
      --correct: #b6ffb6;
      --correct-border: #6ecf6e;
      --incorrect: #ffbaba;
      --incorrect-border: #e57373;
      --progress-bg: #eee;
      --progress-fill: linear-gradient(90deg, #ff66a3, #ff9472);
      --font-size-base: 16px;
      --font-size-lg: 20px;
    }

    /* Dark Mode */
    .dark-mode {
      --bg: #1e1e1e;
      --text: #f4f4f4;
      --card-bg: #2a2a2a;
      --border-color: #444;
      --button-bg: #3a3a3a;
      --button-border: #666666;
      --button-hover: #555555;
      --button-active-bg: #ff66a3;
      --button-active-text: #fff;
      --correct: #118c4f;
      --correct-border: #0f6d3e;
      --incorrect: #a33a3a;
      --incorrect-border: #842b2b;
      --progress-bg: #444;
    }
    
    body.high-contrast {
        --bg: #000000; --text: #ffffff; --card-bg: #000000; --border-color: #ffffff;
        --button-bg: #000000; --button-border: #ffffff; --button-hover: #333333;
        --button-active-bg: #ffff00; --button-active-text: #000000;
        --correct: #00ff00; --correct-border: #ffffff;
        --incorrect: #ff0000; --incorrect-border: #ffffff;
    }
    
    body.large-text { --font-size-base: 22px; --font-size-lg: 28px; }

    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      text-align: center;
      background: var(--bg);
      color: var(--text);
      font-size: var(--font-size-base);
      transition: background 0.25s, color 0.25s;
    }

    h1 { margin-bottom: 0; font-size: calc(var(--font-size-lg) * 1.5); }
    .subtitle { margin-top: 4px; margin-bottom: 20px; color: #ff66a3; font-size: var(--font-size-base); }

    /* CONTROLS */
    #controls-bar {
      display: flex; flex-direction: column; gap: 16px; margin-bottom: 20px;
      background: var(--card-bg); padding: 15px; border-radius: 12px; border: 1px solid var(--border-color);
    }
    .control-row { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; align-items: center; }
    .section-label { font-weight: bold; font-size: 0.9em; text-transform: uppercase; color: #888; margin-right: 5px; }

    button, select, input[type="text"] {
      padding: 8px 12px; border-radius: 8px; border: 1px solid var(--button-border);
      background: var(--button-bg); cursor: pointer; font-size: var(--font-size-base); color: var(--text);
      min-height: 40px; transition: 0.2s;
    }
    button:hover { background: var(--button-hover); transform: scale(1.03); }
    button:disabled { opacity: 0.6; cursor: default; transform: none; }
    button.active { background: var(--button-active-bg); color: var(--button-active-text); font-weight: bold; border-color: var(--button-active-bg); }

    .mode-btn.active-mode { background: #ff66a3; color: white; border-color: #ff3385; box-shadow: 0 0 8px rgba(255,102,163,0.4); }
    .mode-btn[data-mode="chaos"] {
        background: linear-gradient(45deg, #ff00ff, #00ffff, #ff00ff); background-size: 200% 200%;
        animation: gradientShift 3s ease infinite; color: white; border: none; font-weight: bold;
    }
    @keyframes gradientShift { 0% {background-position:0% 50%} 50% {background-position:100% 50%} 100% {background-position:0% 50%} }

    /* QUIZ AREA */
    #quiz-area {
      background: var(--card-bg); border-radius: 12px; padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05); border: 1px solid var(--border-color);
      min-height: 300px; display: flex; flex-direction: column; justify-content: center;
      position: relative; overflow: hidden;
    }
    #question-text { font-size: var(--font-size-lg); margin-bottom: 20px; font-weight: bold; z-index: 2; }
    
    #options-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; width: 100%; z-index: 2; }
    @media (max-width: 600px) { #options-container { grid-template-columns: 1fr; } }
    
    .option-btn { padding: 16px; width: 100%; text-align: center; position: relative; }
    .option-btn.selected { border-color: #6666ff; box-shadow: 0 0 4px rgba(0,0,0,0.2); background-color: #e6e6ff; }
    .dark-mode .option-btn.selected { background-color: #4a4a6a; }
    .option-btn.correct { background: var(--correct) !important; border-color: var(--correct-border) !important; color: #000; }
    .option-btn.incorrect { background: var(--incorrect) !important; border-color: var(--incorrect-border) !important; color: #000; }

    #text-input-container { display: none; flex-direction: column; align-items: center; gap: 12px; width: 100%; z-index: 2; }
    input[type="text"] { width: 100%; max-width: 400px; text-align: center; }

    /* FLASHCARDS */
    #flashcard-container { display: none; perspective: 1000px; width: 100%; height: 300px; cursor: pointer; z-index: 2; }
    #flashcard-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
    .flashcard-flipped #flashcard-inner { transform: rotateY(180deg); }
    .flashcard-face {
        position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
        border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center;
        padding: 20px; box-sizing: border-box; border: 2px solid var(--button-border); background: var(--card-bg);
    }
    .flashcard-front { background: var(--button-bg); }
    .flashcard-back { background: var(--card-bg); transform: rotateY(180deg); }
    .fc-content { font-size: var(--font-size-lg); font-weight: bold; }

    /* PILLS */
    .checkbox-group { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
    .pill-checkbox { display: none; }
    .pill-label {
        padding: 6px 12px; border-radius: 20px; border: 1px solid var(--button-border);
        background: var(--card-bg); cursor: pointer; font-size: 0.9em; transition: all 0.2s;
    }
    .pill-checkbox:checked + .pill-label { background: var(--button-active-bg); color: var(--button-active-text); border-color: var(--button-active-bg); }

    #feedback { min-height: 24px; margin: 15px 0; font-weight: bold; font-size: var(--font-size-lg); z-index: 2; }
    #self-grade-buttons { display: none; gap: 10px; margin-top: 15px; justify-content: center; z-index: 2; }
    #btn-got-it { background: #b6ffb6; border-color: #6ecf6e; color: #000; }
    #btn-missed-it { background: #ffbaba; border-color: #e57373; color: #000; }

    #bottom-bar { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding-top: 10px; border-top: 1px solid var(--border-color); z-index: 2; }
    
    #quiz-checkboxes { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 8px; text-align: left; margin-top: 10px; }
    #quiz-checkboxes label { cursor: pointer; font-size: 0.85em; display: flex; align-items: center; gap: 6px; padding: 4px; background: rgba(0,0,0,0.03); border-radius: 4px; }
    .dark-mode #quiz-checkboxes label { background: rgba(255,255,255,0.05); }

    /* GAME HUD */
    #game-hud { display: none; justify-content: space-between; width: 100%; margin-bottom: 10px; font-weight: bold; font-size: var(--font-size-lg); z-index: 2; }
    #timer-display { color: #ff66a3; }
    .time-added { color: green; animation: floatUp 1s forwards; position: absolute; }
    .time-lost { color: red; animation: floatUp 1s forwards; position: absolute; }
    @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-20px); opacity: 0; } }

    /* PROGRESS */
    #progress-bar { width: 100%; height: 8px; background: var(--progress-bg); border-radius: 4px; margin: 15px 0; overflow: hidden; }
    #progress-fill { height: 100%; width: 0%; background: var(--progress-fill); border-radius: 4px; transition: width 0.3s ease-in-out; }

    /* DISCO & CHAOS */
    #disco-ball { position: fixed; top: 20px; right: 20px; font-size: 40px; cursor: pointer; z-index: 9999; }
    .disco-bg { animation: discoFade 8s infinite alternate; }
    @keyframes discoFade { 0% { background-color: #ffecf2; } 50% { background-color: #e0f7ff; } 100% { background-color: #fff5e0; } }
    .dark-mode .disco-bg { animation: discoFadeDark 8s infinite alternate; }
    @keyframes discoFadeDark { 0% { background-color: #4a1a2c; } 50% { background-color: #1a3a4a; } 100% { background-color: #4a3a1a; } }

    /* Chaos Animations */
    @keyframes chaos-float { 0% { transform: translate(0,0) rotate(0deg); } 33% { transform: translate(10px,-10px) rotate(2deg); } 66% { transform: translate(-10px,10px) rotate(-2deg); } 100% { transform: translate(0,0); } }
    @keyframes chaos-shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
    @keyframes chaos-blur { 0% { filter: blur(0); } 50% { filter: blur(1.5px); } 100% { filter: blur(0); } }
    
    .effect-float { animation: chaos-float 3s ease-in-out infinite; }
    .effect-shake { animation: chaos-shake 0.4s linear infinite; }
    .effect-blur { animation: chaos-blur 2s ease-in-out infinite; }

    /* OVERLAYS */
    #instructions-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 10000; justify-content: center; align-items: center; color: white; flex-direction: column; }
    #instructions-content { background: #333; padding: 30px; border-radius: 15px; max-width: 500px; text-align: center; border: 2px solid #ff66a3; }
    #a11y-panel { display: none; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 8px; margin-top: 10px; width: 100%; }
    #a11y-panel.open { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
  </style>
</head>
<body>

  <div id="disco-ball" title="Disco Mode (Gentle)">ü™©</div>

  <!-- GAME OVERLAY -->
  <div id="instructions-overlay">
      <div id="instructions-content">
          <h2 id="overlay-title" style="color:#ff66a3;">TIME ATTACK</h2>
          <p id="overlay-desc" style="font-size:1.2em;">Answer fast!</p>
          <ul id="overlay-list" style="text-align:left; font-size:1.1em; line-height:1.6;"></ul>
          <button id="btn-start-game" style="background:#ff66a3; color:white; font-size:1.2em; padding:10px 30px;">START GAME</button>
          <br><br>
          <button id="btn-cancel-game" style="background:transparent; border:1px solid #aaa; color:#aaa;">Cancel</button>
      </div>
  </div>

  <h1>Top 200 Drugs Quiz</h1>
  <h2 class="subtitle">Built for no apparent reason</h2>
  <div id="progress-bar"><div id="progress-fill"></div></div>

  <!-- CONTROLS -->
  <div id="controls-bar">
    <div class="control-row">
        <span class="section-label">Mode:</span>
        <button class="mode-btn active-mode" data-mode="study">Study</button>
        <button class="mode-btn" data-mode="exam">Exam</button>
        <button class="mode-btn" data-mode="flashcards">Flashcards</button>
        <button class="mode-btn" data-mode="game">Time Attack</button>
        <button class="mode-btn" data-mode="chaos">üåÄ CHAOS</button>
    </div>

    <!-- Question Types -->
    <div class="control-row" id="quiz-types-row">
        <span class="section-label">Questions:</span>
        <div class="checkbox-group">
            <input type="checkbox" id="qm1" class="pill-checkbox quiz-mode-check" value="gen_brand" checked><label for="qm1" class="pill-label">Gen ‚Üí Brand</label>
            <input type="checkbox" id="qm2" class="pill-checkbox quiz-mode-check" value="brand_gen"><label for="qm2" class="pill-label">Brand ‚Üí Gen</label>
            <input type="checkbox" id="qm3" class="pill-checkbox quiz-mode-check" value="gen_ind"><label for="qm3" class="pill-label">Gen ‚Üí Ind</label>
            <input type="checkbox" id="qm4" class="pill-checkbox quiz-mode-check" value="brand_ind"><label for="qm4" class="pill-label">Brand ‚Üí Ind</label>
            <input type="checkbox" id="qm5" class="pill-checkbox quiz-mode-check" value="ind_gen"><label for="qm5" class="pill-label">Ind ‚Üí Gen</label>
            <input type="checkbox" id="qm6" class="pill-checkbox quiz-mode-check" value="ind_brand"><label for="qm6" class="pill-label">Ind ‚Üí Brand</label>
            <input type="checkbox" id="qm7" class="pill-checkbox quiz-mode-check" value="gen_class"><label for="qm7" class="pill-label">Gen ‚Üí Class</label>
            <input type="checkbox" id="qm8" class="pill-checkbox quiz-mode-check" value="brand_class"><label for="qm8" class="pill-label">Brand ‚Üí Class</label>
            <input type="checkbox" id="qm9" class="pill-checkbox quiz-mode-check" value="class_gen"><label for="qm9" class="pill-label">Class ‚Üí Gen</label>
            <input type="checkbox" id="qm10" class="pill-checkbox quiz-mode-check" value="class_brand"><label for="qm10" class="pill-label">Class ‚Üí Brand</label>
        </div>
    </div>

    <div class="control-row">
        <div class="control-group" id="input-method-group">
            <span>Input:</span>
            <button class="input-btn active" data-input="buttons">Buttons</button>
            <button class="input-btn" data-input="text">Type</button>
        </div>
        <div class="control-group" id="length-group">
            <span>Length:</span>
            <select id="num-questions">
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="50">50</option>
                <option value="0">Endless</option>
            </select>
        </div>
        <button id="btn-a11y-toggle">Accessibility ‚öôÔ∏è</button>
    </div>

    <div id="a11y-panel">
        <button id="btn-theme-toggle">Dark Mode</button>
        <button id="btn-large-text">Large Text: OFF</button>
        <button id="btn-reduce-motion">Reduce Motion: OFF</button>
        <button id="btn-high-contrast">High Contrast: OFF</button>
    </div>

    <div class="control-row" style="align-items:flex-start;">
        <details style="width:100%;">
            <summary style="cursor:pointer; font-weight:bold; margin-bottom:5px;">Select Quizzes (Fall/Winter)</summary>
            <div id="quiz-checkboxes">
                <!-- FALL -->
                <label><input type="checkbox" class="quiz-check" value="F1" checked> F1: Asthma/Allergies</label>
                <label><input type="checkbox" class="quiz-check" value="F2" checked> F2: Diabetes/Antiplatelet</label>
                <label><input type="checkbox" class="quiz-check" value="F3" checked> F3: Insomnia/Pain/Stim</label>
                <label><input type="checkbox" class="quiz-check" value="F4" checked> F4: GI/Supplements</label>
                <label><input type="checkbox" class="quiz-check" value="F5" checked> F5: Women‚Äôs/Men‚Äôs</label>
                <label><input type="checkbox" class="quiz-check" value="F6" checked> F6: HTN/Lipids</label>
                <label><input type="checkbox" class="quiz-check" value="F7" checked> F7: Antibiotics I</label>
                <label><input type="checkbox" class="quiz-check" value="F8" checked> F8: Antibiotics II</label>
                <label><input type="checkbox" class="quiz-check" value="F9" checked> F9: Antidepressants</label>
                <label><input type="checkbox" class="quiz-check" value="F10" checked> F10: Antipsychotics</label>
                <!-- WINTER -->
                <label><input type="checkbox" class="quiz-check" value="W1" checked> W1: Cardio I</label>
                <label><input type="checkbox" class="quiz-check" value="W2" checked> W2: Cardio II</label>
                <label><input type="checkbox" class="quiz-check" value="W3" checked> W3: Cardio III</label>
                <label><input type="checkbox" class="quiz-check" value="W4" checked> W4: Pain I</label>
                <label><input type="checkbox" class="quiz-check" value="W5" checked> W5: Pain II</label>
                <label><input type="checkbox" class="quiz-check" value="W6" checked> W6: Women/Men/HIV</label>
                <label><input type="checkbox" class="quiz-check" value="W7" checked> W7: Asthma/COPD</label>
                <label><input type="checkbox" class="quiz-check" value="W8" checked> W8: Neurology</label>
                <label><input type="checkbox" class="quiz-check" value="W9" checked> W9: Misc</label>
            </div>
            <div style="margin-top:10px;">
                <button id="select-all-quizzes">All</button>
                <button id="clear-all-quizzes">None</button>
            </div>
        </details>
    </div>

    <button id="start-quiz" style="background:#ff66a3; color:white; font-weight:bold; width:100%;">START SESSION</button>
    <button id="start-smart-review" style="display:none; background:#ffcce0; border-color:#ff66a3;">Review Missed Items</button>
  </div>

  <!-- QUIZ AREA -->
  <div id="quiz-area">
    <div id="game-hud"><span>Time: <span id="timer-display">60</span>s</span><span>Score: <span id="game-score">0</span></span></div>
    <div id="question-text">Welcome! Select settings above and click Start.</div>
    
    <div id="options-container"></div>
    <div id="text-input-container">
        <input type="text" id="answer-input" placeholder="Type answer here..." autocomplete="off">
        <div style="font-size: 0.8em; color: #888; margin-top:5px;">(Press Enter to submit)</div>
    </div>
    
    <div id="flashcard-container">
        <div id="flashcard-inner">
            <div class="flashcard-face flashcard-front">
                <div class="fc-label">Question</div><div class="fc-content" id="fc-front-text">Front</div><div style="margin-top:20px; font-size:0.8em; color:#666;">(Click to flip)</div>
            </div>
            <div class="flashcard-face flashcard-back">
                <div class="fc-label">Answer</div><div class="fc-content" id="fc-back-text">Back</div>
            </div>
        </div>
    </div>

    <div id="feedback"></div>
    <div id="self-grade-buttons"><button id="btn-got-it">I got it</button><button id="btn-missed-it">I missed it</button></div>

    <div id="bottom-bar">
      <span id="progress"></span><span id="score"></span>
      <div class="bottom-buttons">
        <button id="check-answer" disabled style="display:none;">Check</button>
        <button id="next-question" disabled style="display:none;">Next</button>
      </div>
    </div>
  </div>

  <script>
    // --- UTILS ---
    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1)); [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }
    function shootConfetti() {
        if (document.body.classList.contains("reduce-motion") || typeof confetti !== 'function') return;
        [{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1},{x:0.5,y:0.5}].forEach(o => confetti({ particleCount: 100, spread: 100, startVelocity: 40, origin: o }));
    }
    function launchDiscoConfetti() {
      if (document.body.classList.contains("reduce-motion") || typeof confetti !== 'function') return;
      const colors = ['#ff66a3', '#6a5acd', '#39d0ff', '#32cd32', '#ffa500'];
      for (let i=0; i<5; i++) confetti({ particleCount: 60, spread: 120, startVelocity: 30, origin: { x: Math.random(), y: Math.random() }, colors });
    }

    // --- DATA ---
    const fallDrugs = [
        { "generic": "Albuterol", "brand": ["ProAir HFA", "ProAir Respiclick", "Proventil HFA", "Ventolin HFA"], "class": "Selective beta2 adrenergic agonist", "indications": ["Asthma", "Exercise induced asthma"], "quiz": "F1" },
        { "generic": "Montelukast", "brand": ["Singulair"], "class": "Leukotriene receptor antagonist", "indications": ["Asthma", "Exercise induced bronchoconstriction", "Seasonal allergic rhinitis"], "quiz": "F1" },
        { "generic": "Hydroxyzine", "brand": ["Atarax", "Vistaril"], "class": "1st generation antihistamine", "indications": ["Anxiety", "Pruritis", "Sedation"], "quiz": "F1" },
        { "generic": "Meclizine", "brand": ["Antivert", "Dramamine"], "class": "1st generation antihistamine", "indications": ["Motion sickness", "Vertigo"], "quiz": "F1" },
        { "generic": "Cetirizine", "brand": ["Zyrtec"], "class": "2nd generation antihistamine", "indications": ["Allergic rhinitis", "Urticaria"], "quiz": "F1" },
        { "generic": "Fexofenadine", "brand": ["Allegra"], "class": "2nd generation antihistamine", "indications": ["Seasonal allergic rhinitis", "Urticaria"], "quiz": "F1" },
        { "generic": "Epinephrine", "brand": ["Auvi-Q", "EpiPen"], "class": "Anaphylaxis agent", "indications": ["Emergency treatment of anaphylaxis"], "quiz": "F1" },
        { "generic": "Metformin", "brand": ["Glucophage"], "class": "Biguanide", "indications": ["Type 2 diabetes mellitus", "Polycystic ovary syndrome"], "quiz": "F2" },
        { "generic": "Glimepiride", "brand": ["Amaryl"], "class": "Sulfonylurea", "indications": ["Type 2 diabetes mellitus"], "quiz": "F2" },
        { "generic": "Glipizide", "brand": ["Glucotrol"], "class": "Sulfonylurea", "indications": ["Type 2 diabetes mellitus"], "quiz": "F2" },
        { "generic": "Sitagliptin", "brand": ["Januvia"], "class": "Dipeptidyl peptidase-4 inhibitor (DPP4-inhibitor)", "indications": ["Type 2 diabetes mellitus"], "quiz": "F2" },
        { "generic": "Pioglitazone", "brand": ["Actos"], "class": "Thiazolidinedione", "indications": ["Type 2 diabetes mellitus"], "quiz": "F2" },
        { "generic": "Insulin Aspart", "brand": ["NovoLog", "Novolog FlexPen"], "class": "Rapid-acting insulin", "indications": ["Type 1 diabetes mellitus", "Type 2 diabetes mellitus"], "quiz": "F2" },
        { "generic": "Insulin Glargine", "brand": ["Lantus"], "class": "Long-acting insulin", "indications": ["Type 1 diabetes mellitus", "Type 2 diabetes mellitus"], "quiz": "F2" },
        { "generic": "Clopidogrel", "brand": ["Plavix"], "class": "Platelet aggregation inhibitor", "indications": ["Myocardial infarction", "Prevention of thrombosis in arteriosclerotic vascular disease"], "quiz": "F2" },
        { "generic": "Dapagliflozin", "brand": ["Farxiga"], "class": "SGLT2 inhibitor", "indications": ["Type 2 diabetes mellitus", "Heart failure", "Chronic kidney disease"], "quiz": "F2" },
        { "generic": "Empagliflozin", "brand": ["Jardiance"], "class": "SGLT2 inhibitor", "indications": ["Type 2 diabetes mellitus", "Heart failure", "Chronic kidney disease"], "quiz": "F2" },
        { "generic": "Semaglutide", "brand": ["Ozempic", "Rybelsus", "Wegovy"], "class": "GLP-1 receptor agonist", "indications": ["Type 2 diabetes mellitus", "Weight loss"], "quiz": "F2" },
        { "generic": "Dulaglutide", "brand": ["Trulicity"], "class": "GLP-1 receptor agonist", "indications": ["Type 2 diabetes mellitus"], "quiz": "F2" },
        { "generic": "Zolpidem", "brand": ["Ambien"], "class": "Nonbarbiturate hypnotic [C-IV]", "indications": ["Insomnia"], "quiz": "F3" },
        { "generic": "Eszopiclone", "brand": ["Lunesta"], "class": "Nonbarbiturate hypnotic", "indications": ["Insomnia"], "quiz": "F3" },
        { "generic": "Hydrocodone and acetaminophen", "brand": [], "class": "Opioid analgesic [C-II]", "indications": ["Pain (severe)"], "quiz": "F3" },
        { "generic": "Ibuprofen", "brand": ["Motrin"], "class": "NSAID", "indications": ["Fever", "Osteoarthritis", "Pain", "Rheumatoid arthritis"], "quiz": "F3" },
        { "generic": "Meloxicam", "brand": ["Mobic"], "class": "NSAID", "indications": ["Osteoarthritis", "Rheumatoid arthritis"], "quiz": "F3" },
        { "generic": "Lisdexamfetamine", "brand": ["Vyvanse"], "class": "CNS stimulant [C-II]", "indications": ["ADHD", "Binge eating disorder"], "quiz": "F3" },
        { "generic": "Methylphenidate", "brand": ["Concerta", "Ritalin"], "class": "CNS stimulant [C-II]", "indications": ["ADHD", "Narcolepsy"], "quiz": "F3" },
        { "generic": "Atomoxetine", "brand": ["Strattera"], "class": "NRI", "indications": ["ADHD"], "quiz": "F3" },
        { "generic": "Donepezil", "brand": ["Aricept"], "class": "Central cholinesterase inhibitor", "indications": ["Alzheimer disease", "Dementia"], "quiz": "F3" },
        { "generic": "Memantine", "brand": ["Namenda"], "class": "NMDA receptor antagonist", "indications": ["Alzheimer disease"], "quiz": "F3" },
        { "generic": "Esomeprazole", "brand": ["Nexium"], "class": "PPI", "indications": ["H. pylori infection", "GERD", "Prevention of NSAID gastropathy", "Zollinger-Ellison"], "quiz": "F4" },
        { "generic": "Pantoprazole", "brand": ["Protonix"], "class": "PPI", "indications": ["GERD", "Gastric hypersecretion", "Zollinger-Ellison"], "quiz": "F4" },
        { "generic": "Omeprazole", "brand": ["Prilosec"], "class": "PPI", "indications": ["Duodenal/gastric ulcer", "GERD", "H. pylori infection"], "quiz": "F4" },
        { "generic": "Lansoprazole", "brand": ["Prevacid"], "class": "PPI", "indications": ["Duodenal/gastric ulcer", "GERD", "H. pylori infection"], "quiz": "F4" },
        { "generic": "Famotidine", "brand": ["Pepcid"], "class": "H2RA", "indications": ["Duodenal/gastric ulcer", "GERD"], "quiz": "F4" },
        { "generic": "Polyethylene Glycol", "brand": ["Golytely"], "class": "Hyperosmotic laxative", "indications": ["Colonoscopy prep", "Constipation"], "quiz": "F4" },
        { "generic": "Cyanocobalamin", "brand": ["Cobolin-M"], "class": "Essential vitamin", "indications": ["Vitamin B12 deficiency"], "quiz": "F4" },
        { "generic": "Potassium Chloride", "brand": ["Klor-Con"], "class": "Electrolyte, potassium", "indications": ["Hypokalemia"], "quiz": "F4" },
        { "generic": "Sildenafil", "brand": ["Viagra", "Revatio"], "class": "PDE-5 inhibitor", "indications": ["Erectile dysfunction", "Pulmonary hypertension"], "quiz": "F5" },
        { "generic": "Tadalafil", "brand": ["Adcirca", "Cialis"], "class": "PDE-5 inhibitor", "indications": ["BPH", "Erectile dysfunction", "Pulmonary hypertension"], "quiz": "F5" },
        { "generic": "Tamsulosin", "brand": ["Flomax"], "class": "Alpha-1 adrenergic blocker", "indications": ["BPH"], "quiz": "F5" },
        { "generic": "Tolterodine", "brand": ["Detrol", "Detrol LA"], "class": "Antimuscarinic", "indications": ["Overactive bladder"], "quiz": "F5" },
        { "generic": "Oxybutynin", "brand": ["Ditropan"], "class": "Urinary antispasmodic", "indications": ["Overactive bladder", "Neurogenic bladder"], "quiz": "F5" },
        { "generic": "Levothyroxine", "brand": ["Synthroid"], "class": "Thyroid supplement", "indications": ["Hypothyroidism"], "quiz": "F5" },
        { "generic": "Thyroid", "brand": ["Armour Thyroid"], "class": "Thyroid supplement", "indications": ["Hypothyroidism"], "quiz": "F5" },
        { "generic": "Alendronate", "brand": ["Fosamax", "Binosto"], "class": "Bisphosphonate", "indications": ["Osteoporosis", "Paget disease"], "quiz": "F5" },
        { "generic": "Ibandronate", "brand": ["Boniva"], "class": "Bisphosphonate", "indications": ["Osteoporosis"], "quiz": "F5" },
        { "generic": "Risedronate", "brand": ["Actonel", "Atelvia"], "class": "Bisphosphonate", "indications": ["Osteoporosis", "Paget disease"], "quiz": "F5" },
        { "generic": "Raloxifene", "brand": ["Evista"], "class": "SERM", "indications": ["Breast cancer prevention", "Osteoporosis"], "quiz": "F5" },
        { "generic": "Lisinopril", "brand": ["Prinivil", "Zestril"], "class": "ACE inhibitor", "indications": ["Heart failure", "Hypertension", "MI"], "quiz": "F6" },
        { "generic": "Ramipril", "brand": ["Altace"], "class": "ACE inhibitor", "indications": ["Heart failure", "Hypertension", "CV risk reduction"], "quiz": "F6" },
        { "generic": "Losartan", "brand": ["Cozaar"], "class": "ARB", "indications": ["Diabetic nephropathy", "Hypertension"], "quiz": "F6" },
        { "generic": "Atenolol", "brand": ["Tenormin"], "class": "Beta-blocker, cardioselective", "indications": ["Angina", "Hypertension"], "quiz": "F6" },
        { "generic": "Metoprolol", "brand": ["Lopressor", "Toprol XL"], "class": "Beta-blocker", "indications": ["Angina", "Heart failure", "Hypertension", "MI"], "quiz": "F6" },
        { "generic": "Amlodipine", "brand": ["Norvasc"], "class": "CCB", "indications": ["Angina", "Hypertension"], "quiz": "F6" },
        { "generic": "Furosemide", "brand": ["Lasix"], "class": "Loop diuretic", "indications": ["Edema", "Hypertension"], "quiz": "F6" },
        { "generic": "Hydrochlorothiazide", "brand": [], "class": "Thiazide diuretic", "indications": ["Edema", "Hypertension"], "quiz": "F6" },
        { "generic": "Atorvastatin", "brand": ["Lipitor"], "class": "HMG-CoA reductase inhibitor", "indications": ["Hyperlipidemia", "CV prevention", "Familial hypercholesterolemia"], "quiz": "F6" },
        { "generic": "Simvastatin", "brand": ["Zocor"], "class": "HMG-CoA reductase inhibitor", "indications": ["Hyperlipidemia", "CV prevention", "Familial hypercholesterolemia"], "quiz": "F6" },
        { "generic": "Fenofibrate", "brand": ["Lofibra", "Tricor"], "class": "Antihyperlipidemic", "indications": ["Hypercholesterolemia", "Hypertriglyceridemia"], "quiz": "F6" },
        { "generic": "Azithromycin", "brand": ["Zithromax", "Z-Pak"], "class": "Macrolide antibiotic", "indications": ["Bacterial sinusitis", "Pneumonia", "Pharyngitis"], "quiz": "F7" },
        { "generic": "Ciprofloxacin (oral)", "brand": ["Cipro", "Cipro XR"], "class": "Fluoroquinolone antibiotic", "indications": ["Bronchitis", "Sinusitis", "UTI"], "quiz": "F7" },
        { "generic": "Ciprofloxacin (ear)", "brand": ["Cetraxal", "Otiprio"], "class": "Fluoroquinolone antibiotic", "indications": ["Otitis externa", "Otitis media with effusion"], "quiz": "F7" },
        { "generic": "Levofloxacin", "brand": ["Levaquin"], "class": "Fluoroquinolone antibiotic", "indications": ["Bacterial sinusitis", "Bronchitis", "Pneumonia"], "quiz": "F7" },
        { "generic": "Amoxicillin", "brand": ["Amoxil"], "class": "Beta-lactam antibiotic", "indications": ["Acute otitis media", "Pharyngitis"], "quiz": "F7" },
        { "generic": "Penicillin", "brand": [], "class": "Beta-lactam antibiotic", "indications": ["Otitis media", "Pharyngitis"], "quiz": "F7" },
        { "generic": "Amoxicillin/Clavulanate", "brand": ["Augmentin"], "class": "Beta-lactam + Beta-lactamase inhibitor", "indications": ["Otitis media", "Sinusitis", "UTI"], "quiz": "F7" },
        { "generic": "Cephalexin", "brand": ["Keflex"], "class": "1st gen cephalosporin", "indications": ["Otitis media", "UTI", "Pharyngitis"], "quiz": "F7" },
        { "generic": "Cefdinir", "brand": ["Omnicef"], "class": "3rd gen cephalosporin", "indications": ["Acute otitis media", "Pharyngitis", "Bronchitis", "Pneumonia"], "quiz": "F7" },
        { "generic": "Valacyclovir", "brand": ["Valtrex"], "class": "Viral DNA polymerase inhibitor", "indications": ["Herpes simplex", "Herpes zoster", "Varicella"], "quiz": "F7" },
        { "generic": "Oseltamivir", "brand": ["Tamiflu"], "class": "Neuraminidase inhibitor", "indications": ["Influenza"], "quiz": "F7" },
        { "generic": "Clindamycin (oral)", "brand": ["Cleocin"], "class": "Lincosamide antibiotic", "indications": ["Skin infection", "Respiratory infection"], "quiz": "F8" },
        { "generic": "Clindamycin (topical)", "brand": ["Cleocin T"], "class": "Lincosamide antibiotic", "indications": ["Acne vulgaris"], "quiz": "F8" },
        { "generic": "Doxycycline", "brand": ["Vibramycin"], "class": "Tetracycline antibiotic", "indications": ["Acne vulgaris", "Skin infection"], "quiz": "F8" },
        { "generic": "Metronidazole", "brand": ["Flagyl"], "class": "Nitroimidazole antibiotic", "indications": ["Abscess"], "quiz": "F8" },
        { "generic": "Chlorhexidine Gluconate", "brand": ["Peridex", "Hibiclens"], "class": "Antibacterial cleansing agent", "indications": ["Gingivitis", "Skin cleansing"], "quiz": "F8" },
        { "generic": "Mupirocin", "brand": ["Bactroban"], "class": "Topical antibiotic", "indications": ["Impetigo"], "quiz": "F8" },
        { "generic": "Nitrofurantoin", "brand": ["Macrodantin", "Macrobid"], "class": "Nitrofuran antibiotic", "indications": ["UTI"], "quiz": "F8" },
        { "generic": "Trimethoprim-Sulfamethoxazole", "brand": ["Bactrim", "Septra"], "class": "Sulfonamide antibiotic", "indications": ["UTI"], "quiz": "F8" },
        { "generic": "Fluconazole", "brand": ["Diflucan"], "class": "Imidazole antifungal", "indications": ["Candidiasis"], "quiz": "F8" },
        { "generic": "Ketoconazole", "brand": ["Nizoral"], "class": "Imidazole antifungal", "indications": ["Dandruff", "Tinea"], "quiz": "F8" },
        { "generic": "Nystatin (systemic)", "brand": ["Bio-Statin"], "class": "Polyene antifungal", "indications": ["Oropharyngeal candidiasis"], "quiz": "F8" },
        { "generic": "Nystatin (topical)", "brand": ["Mycostatin", "Nyamyc", "Nystop"], "class": "Polyene antifungal", "indications": ["Skin candidiasis"], "quiz": "F8" },
        { "generic": "Clobetasol", "brand": ["Temovate"], "class": "Topical corticosteroid", "indications": ["Plaque psoriasis"], "quiz": "F8" },
        { "generic": "Prednisone", "brand": ["Deltasone"], "class": "Corticosteroid", "indications": ["Inflammatory disorders"], "quiz": "F8" },
        { "generic": "Amitriptyline", "brand": ["Elavil"], "class": "Tricyclic antidepressant", "indications": ["Depression"], "quiz": "F9" },
        { "generic": "Nortriptyline", "brand": ["Pamelor"], "class": "Tricyclic antidepressant", "indications": ["Depression"], "quiz": "F9" },
        { "generic": "Citalopram", "brand": ["Celexa"], "class": "SSRI", "indications": ["Depression"], "quiz": "F9" },
        { "generic": "Paroxetine", "brand": ["Paxil", "Paxil CR"], "class": "SSRI", "indications": ["Depression", "GAD", "SAD", "OCD", "Panic disorder", "PTSD", "PMDD", "Menopause symptoms"], "quiz": "F9" },
        { "generic": "Escitalopram", "brand": ["Lexapro"], "class": "SSRI", "indications": ["Depression", "GAD"], "quiz": "F9" },
        { "generic": "Fluoxetine", "brand": ["Prozac", "Sarafem"], "class": "SSRI", "indications": ["Depression", "OCD", "Panic disorder", "PMDD"], "quiz": "F9" },
        { "generic": "Sertraline", "brand": ["Zoloft"], "class": "SSRI", "indications": ["Depression", "OCD", "Panic disorder", "PMDD"], "quiz": "F9" },
        { "generic": "Duloxetine", "brand": ["Cymbalta"], "class": "SNRI", "indications": ["Anxiety", "Depression", "Neuropathy pain"], "quiz": "F9" },
        { "generic": "Venlafaxine", "brand": ["Effexor", "Effexor XR"], "class": "SNRI", "indications": ["Depression", "GAD", "Panic disorder", "SAD"], "quiz": "F9" },
        { "generic": "Lithium", "brand": ["Eskalith", "Eskalith-CR", "Lithobid"], "class": "Antimanic", "indications": ["Bipolar disorder"], "quiz": "F9" },
        { "generic": "Mirtazapine", "brand": ["Remeron"], "class": "Antidepressant, alpha-2 antagonist", "indications": ["Depression"], "quiz": "F9" },
        { "generic": "Bupropion", "brand": ["Wellbutrin", "Zyban"], "class": "Monocyclic antidepressant", "indications": ["Depression", "SAD", "Smoking cessation"], "quiz": "F9" },
        { "generic": "Trazodone", "brand": ["Desyrel"], "class": "Antidepressant", "indications": ["Depression", "Insomnia"], "quiz": "F9" },
        { "generic": "Aripiprazole", "brand": ["Abilify"], "class": "Atypical antipsychotic", "indications": ["Bipolar", "Schizophrenia", "Depression", "Tourette‚Äôs"], "quiz": "F10" },
        { "generic": "Olanzapine", "brand": ["Zyprexa"], "class": "Atypical antipsychotic", "indications": ["Bipolar", "Schizophrenia", "Depression"], "quiz": "F10" },
        { "generic": "Risperidone", "brand": ["Risperdal"], "class": "Atypical antipsychotic", "indications": ["Autism irritability", "Bipolar", "Schizophrenia", "Tourette‚Äôs"], "quiz": "F10" },
        { "generic": "Quetiapine", "brand": ["Seroquel", "Seroquel XR"], "class": "Atypical antipsychotic", "indications": ["Bipolar", "Depression", "Schizophrenia"], "quiz": "F10" },
        { "generic": "Alprazolam", "brand": ["Xanax"], "class": "Benzodiazepine [C-IV]", "indications": ["Anxiety", "Panic disorder"], "quiz": "F10" },
        { "generic": "Clonazepam", "brand": ["Klonopin"], "class": "Benzodiazepine [C-IV]", "indications": ["Panic disorder", "Seizure"], "quiz": "F10" },
        { "generic": "Diazepam", "brand": ["Valium"], "class": "Benzodiazepine [C-IV]", "indications": ["Alcohol withdrawal", "Anxiety", "Seizure"], "quiz": "F10" },
        { "generic": "Lorazepam", "brand": ["Ativan"], "class": "Benzodiazepine [C-IV]", "indications": ["Anxiety", "Insomnia"], "quiz": "F10" },
        { "generic": "Buspirone", "brand": ["BuSpar"], "class": "Antianxiety", "indications": ["Anxiety"], "quiz": "F10" }
    ];

    const winterDrugs = [
        { "generic": "Benazepril", "brand": ["Lotensin"], "class": "ACE Inhibitor", "indications": ["Hypertension", "Heart failure"], "quiz": "W1" },
        { "generic": "Enalapril", "brand": ["Vasotec"], "class": "ACE Inhibitor", "indications": ["Hypertension", "Heart failure"], "quiz": "W1" },
        { "generic": "Quinapril", "brand": ["Accupril"], "class": "ACE Inhibitor", "indications": ["Hypertension", "Heart failure"], "quiz": "W1" },
        { "generic": "Irbesartan", "brand": ["Avapro"], "class": "ARB", "indications": ["Hypertension", "Diabetic nephropathy"], "quiz": "W1" },
        { "generic": "Olmesartan", "brand": ["Benicar"], "class": "ARB", "indications": ["Hypertension"], "quiz": "W1" },
        { "generic": "Doxazosin", "brand": ["Cardura", "Cardura XL"], "class": "Alpha-1 blocker", "indications": ["Hypertension", "BPH"], "quiz": "W1" },
        { "generic": "Terazosin", "brand": ["Hytrin"], "class": "Alpha-1 blocker", "indications": ["Hypertension", "BPH"], "quiz": "W1" },
        { "generic": "Carvedilol", "brand": ["Coreg", "Coreg CR"], "class": "Alpha/Beta-blocker", "indications": ["Hypertension", "Heart failure"], "quiz": "W1" },
        { "generic": "Labetalol", "brand": ["Normodyne"], "class": "Alpha/Beta-blocker", "indications": ["Hypertension"], "quiz": "W1" },
        { "generic": "Propranolol", "brand": ["Inderal", "Inderal LA", "Inderal XL"], "class": "Beta-blocker, nonselective", "indications": ["Hypertension", "Angina", "Arrhythmia", "Migraine"], "quiz": "W1" },
        { "generic": "Diltiazem", "brand": ["Cardizem", "Cartia XT", "Dilt-XR", "Tiazac"], "class": "CCB (non-DHP)", "indications": ["Hypertension", "Angina", "Arrhythmia"], "quiz": "W2" },
        { "generic": "Verapamil", "brand": ["Calan", "Calan SR"], "class": "CCB (non-DHP)", "indications": ["Hypertension", "Angina", "Arrhythmia"], "quiz": "W2" },
        { "generic": "Nifedipine", "brand": ["Adalat CC", "Procardia XL"], "class": "CCB (DHP)", "indications": ["Hypertension", "Angina"], "quiz": "W2" },
        { "generic": "Isosorbide Mononitrate", "brand": ["Imdur"], "class": "Nitrate", "indications": ["Angina"], "quiz": "W2" },
        { "generic": "Nitroglycerin", "brand": ["Minitran", "Nitro-Dur", "Nitrostat"], "class": "Nitrate", "indications": ["Angina", "Anal fissure"], "quiz": "W2" },
        { "generic": "Spironolactone", "brand": ["Aldactone"], "class": "K-sparing diuretic", "indications": ["Hypertension", "Edema", "Heart failure", "Hypokalemia"], "quiz": "W2" },
        { "generic": "Triamterene/HCTZ", "brand": ["Dyazide", "Maxide"], "class": "Diuretic combination", "indications": ["Hypertension", "Edema"], "quiz": "W2" },
        { "generic": "Chlorthalidone", "brand": ["Thalitone"], "class": "Thiazide diuretic", "indications": ["Hypertension", "Edema"], "quiz": "W2" },
        { "generic": "Clonidine", "brand": ["Catapres"], "class": "Alpha-2 agonist", "indications": ["Hypertension", "ADHD"], "quiz": "W2" },
        { "generic": "Tizanidine", "brand": ["Zanaflex"], "class": "Alpha-2 agonist", "indications": ["Muscle spasticity"], "quiz": "W2" },
        { "generic": "Ezetimibe", "brand": ["Zetia"], "class": "Antihyperlipidemic", "indications": ["Hyperlipidemia"], "quiz": "W3" },
        { "generic": "Gemfibrozil", "brand": ["Lopid"], "class": "Antihyperlipidemic", "indications": ["Hyperlipidemia", "Coronary atherosclerosis"], "quiz": "W3" },
        { "generic": "Niacin", "brand": ["Niaspan", "Slo-niacin"], "class": "Antihyperlipidemic", "indications": ["Hyperlipidemia", "MI"], "quiz": "W3" },
        { "generic": "Lovastatin", "brand": ["Altoprev"], "class": "HMG-CoA reductase inhibitor", "indications": ["Hyperlipidemia"], "quiz": "W3" },
        { "generic": "Pravastatin", "brand": ["Pravachol"], "class": "HMG-CoA reductase inhibitor", "indications": ["Hyperlipidemia", "CVA prevention"], "quiz": "W3" },
        { "generic": "Rosuvastatin", "brand": ["Crestor"], "class": "HMG-CoA reductase inhibitor", "indications": ["Hyperlipidemia"], "quiz": "W3" },
        { "generic": "Prasugrel", "brand": ["Effient"], "class": "Antiplatelet", "indications": ["Thromboembolism prevention"], "quiz": "W3" },
        { "generic": "Dabigatran", "brand": ["Pradaxa"], "class": "DOAC", "indications": ["DVT", "PE", "Thromboembolism prevention", "AFib stroke prevention"], "quiz": "W3" },
        { "generic": "Warfarin", "brand": ["Coumadin"], "class": "Anticoagulant", "indications": ["DVT", "PE", "Thrombosis", "AFib"], "quiz": "W3" },
        { "generic": "Digoxin", "brand": ["Lanoxin"], "class": "Digitalis glycoside", "indications": ["Heart failure", "Arrhythmia"], "quiz": "W3" },
        { "generic": "Celecoxib", "brand": ["Celebrex"], "class": "NSAID", "indications": ["OA", "RA", "Pain"], "quiz": "W4" },
        { "generic": "Diclofenac", "brand": ["Voltaren", "Zipsor", "Zorvolex"], "class": "NSAID", "indications": ["OA", "RA", "Pain", "Dysmenorrhea", "Migraine"], "quiz": "W4" },
        { "generic": "Indomethacin", "brand": ["Indocin"], "class": "NSAID", "indications": ["OA", "RA", "Pain", "Gout"], "quiz": "W4" },
        { "generic": "Naproxen", "brand": ["Naprosyn"], "class": "NSAID", "indications": ["OA", "RA", "Pain", "Gout", "Fever"], "quiz": "W4" },
        { "generic": "Lidocaine", "brand": ["Lidoderm"], "class": "Local anesthetic", "indications": ["Pain"], "quiz": "W4" },
        { "generic": "Allopurinol", "brand": ["Zyloprim"], "class": "Xanthine oxidase inhibitor", "indications": ["Gout"], "quiz": "W4" },
        { "generic": "Colchicine", "brand": ["Colcrys"], "class": "Antigout", "indications": ["Gout"], "quiz": "W4" },
        { "generic": "Baclofen", "brand": ["Lioresal"], "class": "Muscle relaxant", "indications": ["Spasticity"], "quiz": "W4" },
        { "generic": "Cyclobenzaprine", "brand": ["Flexeril"], "class": "Muscle relaxant", "indications": ["Spasticity", "Muscle spasm"], "quiz": "W4" },
        { "generic": "Codeine", "brand": ["Tylenol with Codeine"], "class": "Opioid", "indications": ["Pain", "Cough"], "quiz": "W5" },
        { "generic": "Fentanyl", "brand": ["Duragesic"], "class": "Opioid", "indications": ["Pain"], "quiz": "W5" },
        { "generic": "Methadone", "brand": ["Dolophine"], "class": "Opioid", "indications": ["Pain", "Detox"], "quiz": "W5" },
        { "generic": "Morphine", "brand": ["Kadian", "MS Contin"], "class": "Opioid", "indications": ["Pain"], "quiz": "W5" },
        { "generic": "Tramadol", "brand": ["Ultram"], "class": "Opioid", "indications": ["Pain"], "quiz": "W5" },
        { "generic": "Buprenorphine/naloxone", "brand": ["Suboxone"], "class": "Opioid partial agonist/antagonist", "indications": ["Opioid use disorder"], "quiz": "W5" },
        { "generic": "Naloxone", "brand": ["Narcan"], "class": "Opioid antagonist", "indications": ["Opioid overdose"], "quiz": "W5" },
        { "generic": "Gabapentin", "brand": ["Neurontin"], "class": "GABA analog", "indications": ["Seizures", "Nerve pain"], "quiz": "W5" },
        { "generic": "Pregabalin", "brand": ["Lyrica"], "class": "Analgesic/Anticonvulsant", "indications": ["Nerve pain", "Seizures", "Fibromyalgia"], "quiz": "W5" },
        { "generic": "Conjugated estrogen", "brand": ["Premarin"], "class": "Estrogen", "indications": ["Menopause", "Primary ovarian failure"], "quiz": "W6" },
        { "generic": "Estradiol", "brand": ["Estrace"], "class": "Estrogen", "indications": ["Menopause", "Breast cancer", "Hypoestrogenism"], "quiz": "W6" },
        { "generic": "Ethinyl estradiol", "brand": ["NuvaRing"], "class": "Contraceptive", "indications": ["Contraception"], "quiz": "W6" },
        { "generic": "Oral contraceptives", "brand": ["Various"], "class": "Contraceptive", "indications": ["Contraception", "Acne"], "quiz": "W6" },
        { "generic": "Medroxyprogesterone", "brand": ["Depo-Provera", "Provera"], "class": "Progestin", "indications": ["Breast cancer", "Contraception", "Amenorrhea"], "quiz": "W6" },
        { "generic": "Testosterone", "brand": ["AndroGel", "Androderm"], "class": "Androgen", "indications": ["Hypogonadism"], "quiz": "W6" },
        { "generic": "Finasteride", "brand": ["Proscar", "Propecia"], "class": "5-alpha reductase inhibitor", "indications": ["BPH", "Alopecia"], "quiz": "W6" },
        { "generic": "Efavirenz", "brand": ["Sustiva"], "class": "Antiretroviral", "indications": ["HIV"], "quiz": "W6" },
        { "generic": "Emtricitabine/tenofovir", "brand": ["Truvada"], "class": "Antiretroviral", "indications": ["HIV"], "quiz": "W6" },
        { "generic": "Budesonide/formoterol", "brand": ["Symbicort"], "class": "ICS/LABA", "indications": ["Asthma", "COPD"], "quiz": "W7" },
        { "generic": "Fluticasone (nasal)", "brand": ["Flonase"], "class": "Intranasal corticosteroid", "indications": ["Rhinitis"], "quiz": "W7" },
        { "generic": "Fluticasone (oral)", "brand": ["Flovent Diskus"], "class": "Inhaled corticosteroid", "indications": ["Asthma"], "quiz": "W7" },
        { "generic": "Fluticasone/salmeterol", "brand": ["Advair"], "class": "ICS/LABA", "indications": ["Asthma", "COPD"], "quiz": "W7" },
        { "generic": "Ipratropium/albuterol", "brand": ["Combivent"], "class": "SAMA/SABA", "indications": ["COPD"], "quiz": "W7" },
        { "generic": "Methylprednisolone", "brand": ["Medrol"], "class": "Corticosteroid", "indications": ["Inflammation"], "quiz": "W7" },
        { "generic": "Mometasone", "brand": ["Nasonex"], "class": "Intranasal corticosteroid", "indications": ["Rhinitis"], "quiz": "W7" },
        { "generic": "Tiotropium", "brand": ["Spiriva"], "class": "LAMA", "indications": ["Asthma", "COPD"], "quiz": "W7" },
        { "generic": "Triamcinolone", "brand": ["-"], "class": "Topical corticosteroid", "indications": ["Skin rash"], "quiz": "W7" },
        { "generic": "Varenicline", "brand": ["Chantix"], "class": "Smoking cessation agent", "indications": ["Tobacco cessation"], "quiz": "W7" },
        { "generic": "Carbidopa/levodopa", "brand": ["Sinemet"], "class": "Antiparkinson", "indications": ["Parkinson disease"], "quiz": "W8" },
        { "generic": "Divalproex", "brand": ["Depakote"], "class": "Anticonvulsant", "indications": ["Seizures", "Bipolar", "Migraine"], "quiz": "W8" },
        { "generic": "Lamotrigine", "brand": ["Lamictal"], "class": "Anticonvulsant", "indications": ["Bipolar", "Seizures"], "quiz": "W8" },
        { "generic": "Levetiracetam", "brand": ["Keppra"], "class": "Anticonvulsant", "indications": ["Seizures"], "quiz": "W8" },
        { "generic": "Topiramate", "brand": ["Topamax"], "class": "Anticonvulsant", "indications": ["Migraine", "Seizures"], "quiz": "W8" },
        { "generic": "Pramipexole", "brand": ["Mirapex"], "class": "Dopamine agonist", "indications": ["Parkinson disease", "Restless leg syndrome"], "quiz": "W8" },
        { "generic": "Ropinirole", "brand": ["Requip"], "class": "Dopamine agonist", "indications": ["Parkinson disease", "Restless legs syndrome"], "quiz": "W8" },
        { "generic": "Phenobarbital", "brand": ["Luminal"], "class": "Barbiturate", "indications": ["Epilepsy", "Sedation"], "quiz": "W8" },
        { "generic": "Sumatriptan", "brand": ["Imitrex"], "class": "Antimigraine", "indications": ["Migraine", "Cluster headaches"], "quiz": "W8" },
        { "generic": "Benzonatate", "brand": ["Tessalon Perles"], "class": "Antitussive", "indications": ["Cough"], "quiz": "W9" },
        { "generic": "Bimatoprost", "brand": ["Lumigan", "Latisse"], "class": "Prostaglandin", "indications": ["Glaucoma", "Hypotrichosis"], "quiz": "W9" },
        { "generic": "Hydrocortisone", "brand": ["Cortizone"], "class": "Topical corticosteroid", "indications": ["Skin disorders"], "quiz": "W9" },
        { "generic": "Hydroxychloroquine", "brand": ["Plaquenil"], "class": "Aminoquinoline", "indications": ["Lupus", "Malaria", "RA"], "quiz": "W9" },
        { "generic": "Latanoprost", "brand": ["Xalantan"], "class": "Prostaglandin", "indications": ["Glaucoma"], "quiz": "W9" },
        { "generic": "Methotrexate", "brand": ["Trexall"], "class": "Antimetabolite", "indications": ["Psoriasis", "RA", "Oncology"], "quiz": "W9" },
        { "generic": "Ondansetron", "brand": ["Zofran"], "class": "Antiemetic", "indications": ["Nausea"], "quiz": "W9" },
        { "generic": "Phenazopyridine", "brand": ["Pyridium"], "class": "Urinary analgesic", "indications": ["Dysuria"], "quiz": "W9" },
        { "generic": "Promethazine", "brand": ["Phenergan"], "class": "Phenothiazine antihistamine", "indications": ["Motion sickness", "Nausea", "Allergy"], "quiz": "W9" }
    ];

    // =====================================
    // GLOBAL STATE
    // =====================================
    let drugs = [];
    
    // Settings
    let currentMode = "study"; 
    let inputMethod = "buttons"; 
    let totalQuestions = 10;      
    
    // Runtime state
    let currentIndex = 0;         
    let score = 0;
    let currentQuestion = null;
    let quizActive = false;
    let discoMode = false;
    
    // Deck System
    let cardDeck = []; 
    
    // Smart Review
    let missedQueue = [];
    let isSmartReviewActive = false;
    
    // Game State
    let gameTime = 60;
    let gameInterval = null;


    // =====================================
    // INIT
    // =====================================
    function init() {
      // Merge Data
      drugs = [...fallDrugs, ...winterDrugs];
      setupListeners();
      updateUIForMode();
      document.getElementById("game-hud").style.display = "none";
    }

    function setupListeners() {
        document.querySelectorAll(".mode-btn").forEach(btn => {
            btn.addEventListener("click", () => {
                document.querySelectorAll(".mode-btn").forEach(b => b.classList.remove("active-mode"));
                btn.classList.add("active-mode");
                currentMode = btn.dataset.mode;
                
                // Toggle chaos class
                if (currentMode === "chaos") {
                    document.getElementById("quiz-area").classList.add("chaos-mode-active");
                } else {
                    document.getElementById("quiz-area").classList.remove("chaos-mode-active");
                }
                
                updateUIForMode();
            });
        });

        document.getElementById("btn-a11y-toggle").addEventListener("click", () => {
            document.getElementById("a11y-panel").classList.toggle("open");
        });

        document.getElementById("btn-theme-toggle").addEventListener("click", () => {
            document.body.classList.toggle("dark-mode");
        });

        document.getElementById("btn-large-text").addEventListener("click", () => {
            document.body.classList.toggle("large-text");
        });

        document.getElementById("btn-reduce-motion").addEventListener("click", () => {
            document.body.classList.toggle("reduce-motion");
            if(discoMode) toggleDisco();
        });
        
        document.getElementById("btn-high-contrast").addEventListener("click", () => {
            document.body.classList.toggle("high-contrast");
        });

        document.querySelectorAll(".input-btn").forEach(btn => {
            btn.addEventListener("click", () => {
                inputMethod = btn.dataset.input;
                document.querySelectorAll(".input-btn").forEach(b => b.classList.remove("active"));
                btn.classList.add("active");
                if (quizActive) renderQuestion(currentQuestion);
            });
        });

        document.getElementById("start-quiz").addEventListener("click", () => {
            if (currentMode === "game" || currentMode === "chaos") {
                const title = document.getElementById("overlay-title");
                const desc = document.getElementById("overlay-desc");
                const list = document.getElementById("overlay-list");
                
                if (currentMode === "chaos") {
                    title.innerText = "üåÄ CHAOS MODE üåÄ";
                    title.style.color = "#00ffff";
                    desc.innerText = "Survive the storm!";
                    list.innerHTML = `
                        <li>‚è±Ô∏è <strong>60 Seconds</strong></li>
                        <li>üå™Ô∏è Questions <strong>float, spin, shake</strong></li>
                        <li>‚úÖ Correct: <strong>+4s</strong></li>
                        <li>‚ùå Wrong: <strong>-5s</strong></li>
                    `;
                } else {
                    title.innerText = "TIME ATTACK";
                    title.style.color = "#ff66a3";
                    desc.innerText = "Answer fast!";
                    list.innerHTML = `
                        <li>‚è±Ô∏è <strong>60 Seconds</strong></li>
                        <li>‚úÖ Correct: <strong>+3s</strong></li>
                        <li>‚ùå Wrong: <strong>-5s</strong></li>
                    `;
                }
                document.getElementById("instructions-overlay").style.display = "flex";
            } else {
                startSession();
            }
        });

        document.getElementById("btn-start-game").addEventListener("click", () => {
            document.getElementById("instructions-overlay").style.display = "none";
            startGameSession();
        });
        document.getElementById("btn-cancel-game").addEventListener("click", () => {
            document.getElementById("instructions-overlay").style.display = "none";
        });

        document.getElementById("check-answer").addEventListener("click", checkAnswer);
        document.getElementById("next-question").addEventListener("click", nextQuestion);
        
        document.getElementById("flashcard-container").addEventListener("click", function() {
            this.classList.toggle("flashcard-flipped");
        });

        document.getElementById("disco-ball").addEventListener("click", toggleDisco);
        
        document.getElementById("answer-input").addEventListener("keypress", (e) => {
            if (e.key === "Enter" && !document.getElementById("check-answer").disabled) checkAnswer();
        });
        
        document.getElementById("select-all-quizzes").addEventListener("click", () => {
            document.querySelectorAll(".quiz-check").forEach(b => (b.checked = true));
        });

        document.getElementById("clear-all-quizzes").addEventListener("click", () => {
            document.querySelectorAll(".quiz-check").forEach(b => (b.checked = false));
        });
    }

    function toggleDisco() {
        if(document.body.classList.contains("reduce-motion")) return;
        discoMode = !discoMode;
        if(discoMode) {
            document.body.classList.add("disco-bg");
            document.getElementById("disco-ball").classList.add("disco-spin");
            launchDiscoConfetti();
        } else {
            document.body.classList.remove("disco-bg");
            document.getElementById("disco-ball").classList.remove("disco-spin");
        }
    }

    function updateUIForMode() {
        const quizTypeRow = document.getElementById("quiz-types-row");
        const inputGroup = document.getElementById("input-method-group");
        const lengthGroup = document.getElementById("length-group");
        const startBtn = document.getElementById("start-quiz");

        quizTypeRow.style.display = "flex";
        inputGroup.style.display = "flex";
        lengthGroup.style.display = "flex";
        startBtn.innerText = "START SESSION";

        if (currentMode === "flashcards") {
            inputGroup.style.display = "none";
            startBtn.innerText = "START FLASHCARDS";
        } else if (currentMode === "game" || currentMode === "chaos") {
            inputGroup.style.display = "none"; 
            lengthGroup.style.display = "none"; 
            startBtn.innerText = currentMode === "chaos" ? "ENTER CHAOS" : "OPEN GAME LOBBY";
        } else if (currentMode === "exam") {
            startBtn.innerText = "START EXAM";
        }
    }

    function updateScoreAndProgress() {
      const progressEl = document.getElementById("progress");
      const scoreEl = document.getElementById("score");
      const fill = document.getElementById("progress-fill");

      if (currentMode === 'game' || currentMode === 'chaos') {
          const gameScoreEl = document.getElementById("game-score");
          if(gameScoreEl) gameScoreEl.innerText = score;
          progressEl.innerText = "";
          scoreEl.innerText = "";
          if(fill) fill.style.width = "100%";
          return;
      }

      if (!quizActive) {
        progressEl.innerText = "";
        scoreEl.innerText = "";
        if (fill) fill.style.width = "0%";
        return;
      }

      if (isSmartReviewActive) {
          progressEl.innerText = `Smart Review: Question ${currentIndex + 1}`;
      } else {
          progressEl.innerText = totalQuestions === 0 ? `Question ${currentIndex + 1}` : `Question ${currentIndex + 1} of ${totalQuestions}`;
      }

      scoreEl.innerText = (currentMode === 'exam') ? "" : `Score: ${score}`;

      if (fill) {
        if (!isSmartReviewActive && totalQuestions !== 0) {
          const pct = (currentIndex / totalQuestions) * 100;
          fill.style.width = `${pct}%`;
        } else {
           fill.style.width = "100%"; 
        }
      }
    }

    // =====================================
    // CORE LOGIC
    // =====================================

    function getActiveQuizTypes() {
        const checks = document.querySelectorAll(".quiz-mode-check:checked");
        const types = Array.from(checks).map(c => c.value);
        return types.length > 0 ? types : ["gen_brand"];
    }

    function getFilteredDrugs() {
        if (isSmartReviewActive) return missedQueue;
        const checks = document.querySelectorAll(".quiz-check:checked");
        const selected = Array.from(checks).map(c => c.value);
        if (selected.length === 0) return drugs;
        return drugs.filter(d => d.quiz && selected.includes(d.quiz));
    }

    function buildCardDeck() {
        cardDeck = [];
        const pool = getFilteredDrugs();
        const types = getActiveQuizTypes();
        if (pool.length === 0) return;
        
        pool.forEach(drug => {
            const validTypes = types.filter(t => isValidQuestionType(t, drug));
            if (validTypes.length > 0) {
                const type = validTypes[Math.floor(Math.random() * validTypes.length)];
                cardDeck.push({ drug, type });
            }
        });
        shuffleArray(cardDeck);
    }

    function isValidQuestionType(type, drug) {
        switch(type) {
            case 'gen_brand': case 'brand_gen': return drug.brand && drug.brand.length > 0;
            case 'gen_ind': case 'ind_gen': return drug.indications && drug.indications.length > 0;
            case 'brand_ind': case 'ind_brand': return drug.brand && drug.brand.length > 0 && drug.indications && drug.indications.length > 0;
            case 'gen_class': case 'class_gen': return drug.class && drug.class.length > 0;
            case 'brand_class': case 'class_brand': return drug.brand && drug.brand.length > 0 && drug.class && drug.class.length > 0;
            default: return false;
        }
    }

    function startSession() {
        quizActive = true;
        isSmartReviewActive = false;
        missedQueue = []; 
        currentIndex = 0;
        score = 0;
        totalQuestions = parseInt(document.getElementById("num-questions").value);
        
        buildCardDeck(); 
        if (cardDeck.length === 0) { alert("No questions available."); return; }

        document.getElementById("game-hud").style.display = "none";
        document.getElementById("feedback").innerText = "";
        document.getElementById("next-question").disabled = true;
        document.getElementById("self-grade-buttons").style.display = "none";
        document.getElementById("flashcard-container").classList.remove("flashcard-flipped");

        generateQuestion();
        updateScoreAndProgress();
    }
    
    function startSmartReview() {
        isSmartReviewActive = true;
        const types = getActiveQuizTypes();
        cardDeck = [];
        missedQueue.forEach(drug => {
             const validTypes = types.filter(t => isValidQuestionType(t, drug));
             if(validTypes.length > 0) {
                 cardDeck.push({ drug, type: validTypes[Math.floor(Math.random() * validTypes.length)] });
             }
        });
        shuffleArray(cardDeck);
        startSessionCommon();
    }
    
    function startSessionCommon() {
        quizActive = true;
        currentIndex = 0;
        score = 0;
        document.getElementById("game-hud").style.display = "none";
        document.getElementById("feedback").innerText = "";
        document.getElementById("next-question").disabled = true;
        document.getElementById("self-grade-buttons").style.display = "none";
        generateQuestion();
        updateScoreAndProgress();
    }
    
    function startGameSession() {
        quizActive = true;
        score = 0;
        gameTime = 60;
        inputMethod = "buttons"; 
        buildCardDeck();
        if (cardDeck.length === 0) { alert("No questions available."); return; }
        
        document.getElementById("game-hud").style.display = "flex";
        document.getElementById("timer-display").innerText = gameTime;
        document.getElementById("game-score").innerText = score;
        document.getElementById("feedback").innerText = "";
        document.getElementById("next-question").disabled = true;
        document.getElementById("self-grade-buttons").style.display = "none";
        
        if (gameInterval) clearInterval(gameInterval);
        gameInterval = setInterval(() => {
            gameTime--;
            document.getElementById("timer-display").innerText = gameTime;
            if (gameTime <= 0) endGame();
        }, 1000);
        generateQuestion();
    }

    function generateQuestion() {
        if (currentMode !== "game" && currentMode !== "chaos" && !isSmartReviewActive && totalQuestions !== 0 && currentIndex >= totalQuestions) {
            endQuiz(); return;
        }
        if (cardDeck.length === 0) {
            if (isSmartReviewActive) { endQuiz(); return; }
            else buildCardDeck();
        }

        const card = cardDeck.pop(); 
        currentQuestion = buildQuestion(card.type, card.drug);
        if (!currentQuestion) { generateQuestion(); return; }

        renderQuestion(currentQuestion);
        updateScoreAndProgress();
    }
    
    function buildQuestion(type, drug) {
        const getDistractors = (filterFn, mapFn) => {
            let others = drugs.filter(d => d !== drug && filterFn(d)).map(mapFn);
            others = [...new Set(others)];
            shuffleArray(others);
            return others.slice(0, 3);
        };

        let q = { drug, type, options: [], prompt: "", correctText: "" };

        switch(type) {
            case "gen_brand":
                q.prompt = `Brand name for ${drug.generic}?`; q.correctText = drug.brand[0];
                q.options = [{ text: drug.brand[0], correct: true }, ...getDistractors(d => d.brand, d => d.brand[0]).map(t => ({ text: t, correct: false }))]; break;
            case "brand_gen":
                q.prompt = `Generic name for ${drug.brand[0]}?`; q.correctText = drug.generic;
                q.options = [{ text: drug.generic, correct: true }, ...getDistractors(d => true, d => d.generic).map(t => ({ text: t, correct: false }))]; break;
            case "gen_ind":
                q.prompt = `Indications for ${drug.generic}?`; q.correctText = drug.indications.join(", ");
                let wrongInds = Array.from(new Set(drugs.flatMap(d => d.indications || []))).filter(i => !drug.indications.includes(i));
                shuffleArray(wrongInds);
                q.options = [...drug.indications.map(i => ({ text: i, correct: true })), ...wrongInds.slice(0, 3).map(i => ({ text: i, correct: false }))];
                q.multiSelect = true; break;
            case "brand_ind":
                q.prompt = `Indications for ${drug.brand[0]}?`; q.correctText = drug.indications.join(", ");
                let wrongIndsBI = Array.from(new Set(drugs.flatMap(d => d.indications || []))).filter(i => !drug.indications.includes(i));
                shuffleArray(wrongIndsBI);
                q.options = [...drug.indications.map(i => ({ text: i, correct: true })), ...wrongIndsBI.slice(0, 3).map(i => ({ text: i, correct: false }))];
                q.multiSelect = true; break;
            case "ind_gen":
                const tIG = drug.indications[Math.floor(Math.random() * drug.indications.length)];
                q.prompt = `Which generic treats: "${tIG}"?`; q.correctText = drug.generic;
                q.options = [{ text: drug.generic, correct: true }, ...getDistractors(d => !d.indications || !d.indications.includes(tIG), d => d.generic).map(t => ({ text: t, correct: false }))]; break;
            case "ind_brand":
                const tIB = drug.indications[Math.floor(Math.random() * drug.indications.length)];
                q.prompt = `Which brand treats: "${tIB}"?`; q.correctText = drug.brand[0];
                q.options = [{ text: drug.brand[0], correct: true }, ...getDistractors(d => (!d.indications || !d.indications.includes(tIB)) && d.brand, d => d.brand[0]).map(t => ({ text: t, correct: false }))]; break;
            case "gen_class":
                q.prompt = `Therapeutic Class for ${drug.generic}?`; q.correctText = drug.class;
                q.options = [{ text: drug.class, correct: true }, ...getDistractors(d => d.class && d.class !== drug.class, d => d.class).map(t => ({ text: t, correct: false }))]; break;
            case "brand_class":
                q.prompt = `Therapeutic Class for ${drug.brand[0]}?`; q.correctText = drug.class;
                q.options = [{ text: drug.class, correct: true }, ...getDistractors(d => d.class && d.class !== drug.class, d => d.class).map(t => ({ text: t, correct: false }))]; break;
            case "class_gen":
                q.prompt = `Which generic belongs to: ${drug.class}?`; q.correctText = drug.generic;
                q.options = [{ text: drug.generic, correct: true }, ...getDistractors(d => d.class !== drug.class, d => d.generic).map(t => ({ text: t, correct: false }))]; break;
            case "class_brand":
                q.prompt = `Which brand belongs to: ${drug.class}?`; q.correctText = drug.brand[0];
                q.options = [{ text: drug.brand[0], correct: true }, ...getDistractors(d => d.class !== drug.class && d.brand, d => d.brand[0]).map(t => ({ text: t, correct: false }))]; break;
        }
        
        shuffleArray(q.options);
        return q;
    }

    function renderQuestion(q) {
      if(!q) return;
      const questionEl = document.getElementById("question-text");
      const optionsEl = document.getElementById("options-container");
      const textInputEl = document.getElementById("text-input-container");
      const feedbackEl = document.getElementById("feedback");
      const quizArea = document.getElementById("quiz-area");
      const inputField = document.getElementById("answer-input");
      const selfGradeBtns = document.getElementById("self-grade-buttons");

      questionEl.innerText = q.prompt;
      optionsEl.innerHTML = "";
      feedbackEl.innerText = "";
      inputField.value = "";
      selfGradeBtns.style.display = "none";

      if (currentMode === "chaos") {
          const effects = ["effect-float", "effect-spin", "effect-shake", "effect-blur"]; 
          const randomEffect = effects[Math.floor(Math.random() * effects.length)];
          optionsEl.className = ""; questionEl.className = "";
          if (Math.random() > 0.5) optionsEl.classList.add(randomEffect); else questionEl.classList.add(randomEffect);
      } else {
          optionsEl.className = ""; questionEl.className = "";
      }

      if (currentMode === "flashcards") {
            const fc = document.getElementById("flashcard-container");
            fc.style.display = "block"; optionsEl.style.display = "none"; textInputEl.style.display = "none";
            fc.classList.remove("flashcard-flipped");
            document.getElementById("fc-front-text").innerText = q.prompt;
            document.getElementById("fc-back-text").innerText = q.correctText;
            document.getElementById("check-answer").style.display = "none";
            document.getElementById("next-question").disabled = false;
            document.getElementById("next-question").style.display = "inline-block";
            return;
      }
      
      document.getElementById("flashcard-container").style.display = "none";

      if (inputMethod === "text" && currentMode !== "game" && currentMode !== "chaos") {
          optionsEl.style.display = "none"; textInputEl.style.display = "flex"; inputField.focus();
      } else {
          optionsEl.style.display = "grid"; textInputEl.style.display = "none";
          q.options.forEach((opt, idx) => {
            const btn = document.createElement("button");
            btn.className = "option-btn";
            btn.innerText = opt.text;
            if (currentMode === "chaos") {
                btn.style.transform = `rotate(${Math.random() * 10 - 5}deg) translate(${Math.random() * 20 - 10}px, ${Math.random() * 20 - 10}px)`;
            } else {
                btn.style.transform = "none";
            }
            btn.onclick = () => {
                if (q.multiSelect) btn.classList.toggle("selected");
                else {
                    document.querySelectorAll(".option-btn").forEach(b => b.classList.remove("selected"));
                    btn.classList.add("selected");
                    if (currentMode === "game" || currentMode === "chaos") checkAnswer();
                }
            };
            optionsEl.appendChild(btn);
          });
      }

      document.getElementById("check-answer").disabled = false;
      document.getElementById("next-question").disabled = true;
      document.getElementById("check-answer").style.display = "inline-block";
      
      quizArea.classList.remove("fade"); void quizArea.offsetWidth; quizArea.classList.add("fade");
    }

    function checkAnswer() {
      if (!currentQuestion) return;
      const q = currentQuestion;
      if (currentMode === "flashcards") { nextQuestion(); return; }
      
      let isCorrect = false;
      const feedback = document.getElementById("feedback");

      if (inputMethod === "buttons" || currentMode === "game" || currentMode === "chaos") {
          const selected = Array.from(document.querySelectorAll(".option-btn.selected"));
          if (selected.length === 0 && !q.multiSelect) { feedback.innerText = "Select an answer."; return; }

          let allCorrect = true;
          document.querySelectorAll(".option-btn").forEach((btn, idx) => {
            const opt = q.options[idx];
            const isSelected = btn.classList.contains("selected");
            if ((opt.correct && !isSelected) || (!opt.correct && isSelected)) allCorrect = false;
            if (currentMode !== 'exam') {
                if (opt.correct) btn.classList.add("correct");
                else if (isSelected) btn.classList.add("incorrect");
            }
          });
          isCorrect = allCorrect;
      } else {
          const val = document.getElementById("answer-input").value.trim().toLowerCase();
          if (!val) { feedback.innerText = "Type an answer."; return; }
          const isComplex = q.type.includes("ind") || q.type.includes("class"); 
          if (!isComplex) {
              if (val === q.correctText.toLowerCase()) {
                  isCorrect = true; feedback.innerText = "Correct!"; feedback.style.color = "green";
              } else {
                  isCorrect = false; feedback.innerHTML = `Incorrect. Answer: ${q.correctText}`; feedback.style.color = "red";
              }
          } else {
              feedback.innerHTML = `Correct: ${q.correctText}<br>Did you get it?`;
              document.getElementById("self-grade-buttons").style.display = "flex";
              document.getElementById("check-answer").style.display = "none";
              return; 
          }
      }
      processResult(isCorrect);
    }
    
    document.getElementById("btn-got-it").onclick = () => processResult(true);
    document.getElementById("btn-missed-it").onclick = () => processResult(false);

    function processResult(isCorrect) {
        const feedback = document.getElementById("feedback");
        document.getElementById("self-grade-buttons").style.display = "none";
        document.getElementById("check-answer").disabled = true;
        document.getElementById("next-question").disabled = false;
        document.getElementById("next-question").style.display = "inline-block";
        
        document.querySelectorAll(".option-btn").forEach(b => b.onclick = null);

        if (isCorrect) {
            score++; shootConfetti();
            if (currentMode === "game" || currentMode === "chaos") {
                const bonus = currentMode === "chaos" ? 4 : 3;
                gameTime += bonus; showFloatingText(`+${bonus}s`, "time-added");
                feedback.innerText = "Correct!"; setTimeout(nextQuestion, 800); 
            } else if (currentMode !== "exam") {
                feedback.innerText = "Correct!"; feedback.style.color = "var(--correct)";
            }
        } else {
            if (!missedQueue.includes(currentQuestion.drug)) missedQueue.push(currentQuestion.drug);
            if (currentMode === "game" || currentMode === "chaos") {
                gameTime -= 5; showFloatingText("-5s", "time-lost");
                feedback.innerText = "Wrong!"; setTimeout(nextQuestion, 800);
            } else if (currentMode !== "exam") {
                feedback.innerText = "Incorrect."; feedback.style.color = "var(--incorrect)";
            }
        }
        updateScoreAndProgress();
    }

    function showFloatingText(text, cls) {
        const el = document.createElement("div"); el.innerText = text; el.className = cls;
        el.style.left = "50%"; el.style.top = "10px";
        document.getElementById("game-hud").appendChild(el); setTimeout(() => el.remove(), 1000);
    }

    function nextQuestion() {
      if (!quizActive) return;
      currentIndex++;
      generateQuestion();
    }

    function endGame() { clearInterval(gameInterval); endQuiz(); }

    function endQuiz() {
      quizActive = false;
      document.getElementById("options-container").innerHTML = "";
      document.getElementById("text-input-container").style.display = "none";
      document.getElementById("flashcard-container").style.display = "none";
      document.getElementById("question-text").innerText = "Session Complete";
      
      let total = currentIndex;
      if (currentMode === 'study' && !isSmartReviewActive && totalQuestions !== 0) total = totalQuestions;
      
      const percent = total > 0 ? (score / total) * 100 : 0;
      let reviewBtnHTML = "";
      if (missedQueue.length > 0) {
          reviewBtnHTML = `<br><button id="btn-review-missed" style="background:#ffcce0; color:#d63384;">Review ${missedQueue.length} Missed Items</button>`;
      }

      document.getElementById("feedback").innerHTML = `
        <div style="font-size: 20px; margin-bottom: 8px;">${(currentMode === "game" || currentMode === "chaos") ? "Time's Up!" : "Quiz Complete!"}</div>
        <div style="font-size: 18px; margin-bottom: 15px;">Score: <strong>${score} / ${total}</strong> (${Math.round(percent)}%)</div>
        ${reviewBtnHTML}
        <br><button onclick="window.location.reload()">Restart App</button>
      `;
      
      if(missedQueue.length > 0) {
          document.getElementById("btn-review-missed").onclick = startSmartReview;
      }

      document.getElementById("check-answer").style.display = "none";
      document.getElementById("next-question").style.display = "none";
    }

    init();
  </script>
</body>
</html>
